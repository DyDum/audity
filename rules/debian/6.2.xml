<RulesCIS>

    <!-- ═════════ 6  Logging and Auditing  →  6.2 System Auditing ═════════ -->

    <!-- ───────────── 6.2.1  Configure auditd Service ───────────── -->

    <Rule id="6.2.1.1">
        <Name>Ensure auditd packages are installed (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.1">Configure auditd Service</SubSection>
        <Profiles>
            <Profile level="2" type="Server"/>
            <Profile level="2" type="Workstation"/>
        </Profiles>
        <BasePath>/usr/sbin/</BasePath>
        <FileName>auditd</FileName>
        <NonCompliantComment>Auditd packages are not installed, which prevents audit logging from functioning.</NonCompliantComment>
        <CorrectiveComment>Install auditd and its dependencies to enable auditing.</CorrectiveComment>
        <Correction><![CDATA[apt-get install -y auditd]]></Correction>
        <Verification><![CDATA[dpkg -l | grep -q auditd && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <Rule id="6.2.1.2">
        <Name>Ensure auditd service is enabled and active (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.1">Configure auditd Service</SubSection>
        <Profiles>
            <Profile level="2" type="Server"/>
            <Profile level="2" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/systemd/system/</BasePath>
        <FileName>auditd.service</FileName>
        <NonCompliantComment>The auditd service is not enabled or running, risking loss of critical audit logs.</NonCompliantComment>
        <CorrectiveComment>Enable and start the auditd service.</CorrectiveComment>
        <Correction><![CDATA[systemctl enable auditd; systemctl start auditd]]></Correction>
        <Verification><![CDATA[systemctl is-active auditd | grep -q "active" && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <Rule id="6.2.1.3">
        <Name>Ensure auditing of early boot processes is enabled (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.1">Configure auditd Service</SubSection>
        <Profiles>
            <Profile level="2" type="Server"/>
            <Profile level="2" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/default/</BasePath>
        <FileName>grub</FileName>
        <NonCompliantComment>Auditing for processes that start before auditd is not enabled.</NonCompliantComment>
        <CorrectiveComment>Add the kernel boot parameter audit=1 in GRUB.</CorrectiveComment>
        <Correction><![CDATA[sed -i 's/\(GRUB_CMDLINE_LINUX="\(.*\)\)"/\1 audit=1"/' /etc/default/grub; update-grub]]></Correction>
        <Verification><![CDATA[grep -q 'audit=1' /proc/cmdline && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <Rule id="6.2.1.4">
        <Name>Ensure audit_backlog_limit is sufficient (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.1">Configure auditd Service</SubSection>
        <Profiles>
            <Profile level="2" type="Server"/>
            <Profile level="2" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/</BasePath>
        <FileName>auditd.conf</FileName>
        <NonCompliantComment>The audit backlog limit is set too low.</NonCompliantComment>
        <CorrectiveComment>Set audit_backlog_limit = 8192 in auditd.conf.</CorrectiveComment>
        <Correction><![CDATA[sed -i 's/^#\?audit_backlog_limit.*/audit_backlog_limit = 8192/' /etc/audit/auditd.conf; systemctl restart auditd]]></Correction>
        <Verification><![CDATA[grep '^audit_backlog_limit = 8192' /etc/audit/auditd.conf && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>


    <!-- ───────────── 6.2.2  Configure Data Retention ───────────── -->

    <Rule id="6.2.2.1">
        <Name>Ensure audit log storage size is configured (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.2">Configure Data Retention</SubSection>
        <Profiles>
            <Profile level="2" type="Server"/>
            <Profile level="2" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/auditd.conf</BasePath>
        <FileName>auditd.conf</FileName>
        <NonCompliantComment>Audit log storage size is not configured.</NonCompliantComment>
        <CorrectiveComment>Set max_log_file = 50 MB.</CorrectiveComment>
        <Correction><![CDATA[sed -i 's/^#\?max_log_file.*/max_log_file = 50/' /etc/audit/auditd.conf; systemctl restart auditd]]></Correction>
        <Verification><![CDATA[grep '^max_log_file = 50' /etc/audit/auditd.conf && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <Rule id="6.2.2.2">
        <Name>Ensure audit logs are not automatically deleted (Manual)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.2">Configure Data Retention</SubSection>
        <Profiles>
            <Profile level="2" type="Server"/>
            <Profile level="2" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/auditd.conf</BasePath>
        <FileName>auditd.conf</FileName>
        <NonCompliantComment>Audit logs may be automatically deleted when full.</NonCompliantComment>
        <CorrectiveComment>Disable automatic audit-log deletion.</CorrectiveComment>
        <Correction><![CDATA[echo "# Automatic log deletion disabled" >> /etc/audit/auditd.conf; systemctl restart auditd]]></Correction>
        <Verification><![CDATA[echo "Manual review required"]]></Verification>
        <Manual>VERIFICATION</Manual>
    </Rule>

    <Rule id="6.2.2.3">
        <Name>Ensure action is taken when audit logs are full (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.2">Configure Data Retention</SubSection>
        <Profiles>
            <Profile level="2" type="Server"/>
            <Profile level="2" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/auditd.conf</BasePath>
        <FileName>auditd.conf</FileName>
        <NonCompliantComment>No action configured when audit logs are full.</NonCompliantComment>
        <CorrectiveComment>Set space_left_action = email.</CorrectiveComment>
        <Correction><![CDATA[sed -i 's/^#\?space_left_action.*/space_left_action = email/' /etc/audit/auditd.conf; systemctl restart auditd]]></Correction>
        <Verification><![CDATA[grep '^space_left_action = email' /etc/audit/auditd.conf && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <Rule id="6.2.2.4">
        <Name>Ensure warning when audit logs are low on space (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.2">Configure Data Retention</SubSection>
        <Profiles>
            <Profile level="2" type="Server"/>
            <Profile level="2" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/auditd.conf</BasePath>
        <FileName>auditd.conf</FileName>
        <NonCompliantComment>No warning when audit logs are low on space.</NonCompliantComment>
        <CorrectiveComment>Set admin_space_left_action = exec.</CorrectiveComment>
        <Correction><![CDATA[sed -i 's/^#\?admin_space_left_action.*/admin_space_left_action = exec/' /etc/audit/auditd.conf; systemctl restart auditd]]></Correction>
        <Verification><![CDATA[grep '^admin_space_left_action = exec' /etc/audit/auditd.conf && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>


    <!-- ───────────── 6.2.3  Configure auditd Rules ───────────── -->

    <Rule id="6.2.3.1">
        <Name>Ensure changes to /etc/sudoers are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="2" type="Server"/>
            <Profile level="2" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>Changes to /etc/sudoers are not audited.</NonCompliantComment>
        <CorrectiveComment>Add an audit rule for /etc/sudoers.</CorrectiveComment>
        <Correction><![CDATA[echo "-w /etc/sudoers -p wa -k scope" >> /etc/audit/rules.d/audit.rules; augenrules --load]]></Correction>
        <Verification><![CDATA[grep -q "\-w /etc/sudoers" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <Rule id="6.2.3.2">
        <Name>Ensure changes to /etc/passwd are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="2" type="Server"/>
            <Profile level="2" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>Modifications to /etc/passwd are not audited.</NonCompliantComment>
        <CorrectiveComment>Add an audit rule for /etc/passwd.</CorrectiveComment>
        <Correction><![CDATA[echo "-w /etc/passwd -p wa -k user_modifications" >> /etc/audit/rules.d/audit.rules; augenrules --load]]></Correction>
        <Verification><![CDATA[grep -q "\-w /etc/passwd" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- (Les autres règles 6.2.3.3 à 6.2.3.19 sont laissées identiques mais complétées de leur en-tête
         Metadata & Profiles, sur le même modèle que ci-dessus) -->
    <Rule id="6.2.3.3">
        <Name>Ensure events that modify the sudo log file are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>Changes to /var/log/sudo.log are not audited, so tampering with privileged-command history may go unnoticed.</NonCompliantComment>
        <CorrectiveComment>Add a watch rule on /var/log/sudo.log for write/attribute changes.</CorrectiveComment>
        <Correction><![CDATA[
echo "-w /var/log/sudo.log -p wa -k sudo_log" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "\-w /var/log/sudo.log" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.4  Ensure events that modify date and time information are collected (Automated) -->
    <Rule id="6.2.3.4">
        <Name>Ensure events that modify date and time information are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>Modifications to system date/time settings are not audited, risking undetected time-based attacks.</NonCompliantComment>
        <CorrectiveComment>Add watch rules for /etc/localtime and clock-related syscalls.</CorrectiveComment>
        <Correction><![CDATA[
echo "-w /etc/localtime -p wa -k time_change" >> /etc/audit/rules.d/audit.rules
echo "-a always,exit -F arch=b64 -S adjtimex,settimeofday,clock_settime -k time_change" >> /etc/audit/rules.d/audit.rules
echo "-a always,exit -F arch=b32 -S adjtimex,settimeofday,clock_settime -k time_change" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=time_change" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.5  Ensure events that modify the system's network environment are collected (Automated) -->
    <Rule id="6.2.3.5">
        <Name>Ensure events that modify the system's network environment are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>Changes to network configuration files are not audited, so rogue interface or route changes may be missed.</NonCompliantComment>
        <CorrectiveComment>Add a recursive watch on /etc/network/ and /etc/hosts.allow|deny.</CorrectiveComment>
        <Correction><![CDATA[
echo "-w /etc/network/ -p wa -k network_env" >> /etc/audit/rules.d/audit.rules
echo "-w /etc/hosts.allow -p wa -k network_env" >> /etc/audit/rules.d/audit.rules
echo "-w /etc/hosts.deny  -p wa -k network_env" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=network_env" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.6  Ensure use of privileged commands is collected (Automated) -->
    <Rule id="6.2.3.6">
        <Name>Ensure use of privileged commands is collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>Execution of set-UID or set-GID binaries is not audited, limiting forensic visibility.</NonCompliantComment>
        <CorrectiveComment>Generate rules for every SUID/SGID file found under the filesystem.</CorrectiveComment>
        <Correction><![CDATA[
find / -xdev \( -perm -4000 -o -perm -2000 \) -type f 2>/dev/null | \
while read f; do echo "-a always,exit -F path=$f -F perm=x -F auid>=1000 -F auid!=-1 -k privileged_cmd"; done >> /etc/audit/rules.d/privileged.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=privileged_cmd" /etc/audit/rules.d/privileged.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.7  Ensure unsuccessful file access attempts are collected (Automated) -->
    <Rule id="6.2.3.7">
        <Name>Ensure unsuccessful file access attempts are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>Failed open(2) calls are not audited, hindering detection of reconnaissance activity.</NonCompliantComment>
        <CorrectiveComment>Add a syscall rule to capture open/openat failures (exit codes -EPERM/-EACCES).</CorrectiveComment>
        <Correction><![CDATA[
echo "-a always,exit -F arch=b64 -S open,openat,open_by_handle_at -F exit=-EACCES -F key=access_denied" >> /etc/audit/rules.d/audit.rules
echo "-a always,exit -F arch=b64 -S open,openat,open_by_handle_at -F exit=-EPERM  -F key=access_denied" >> /etc/audit/rules.d/audit.rules
echo "-a always,exit -F arch=b32 -S open,openat            -F exit=-EACCES -F key=access_denied" >> /etc/audit/rules.d/audit.rules
echo "-a always,exit -F arch=b32 -S open,openat            -F exit=-EPERM  -F key=access_denied" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=access_denied" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.8  Ensure events that modify user/group information are collected (Automated) -->
    <Rule id="6.2.3.8">
        <Name>Ensure events that modify user/group information are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>User and group databases are modified without audit coverage.</NonCompliantComment>
        <CorrectiveComment>Watch /etc/passwd, /etc/group, /etc/shadow and /etc/gshadow.</CorrectiveComment>
        <Correction><![CDATA[
for f in /etc/passwd /etc/group /etc/shadow /etc/gshadow; do
    echo "-w $f -p wa -k identity_change" >> /etc/audit/rules.d/audit.rules
done
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=identity_change" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.9  Ensure discretionary access control permission modification events are collected (Automated) -->
    <Rule id="6.2.3.9">
        <Name>Ensure discretionary access control permission modification events are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>Changes to file permissions and ownership are not audited.</NonCompliantComment>
        <CorrectiveComment>Add syscall rules for chmod/chown family.</CorrectiveComment>
        <Correction><![CDATA[
echo "-a always,exit -F arch=b64 -S chmod,fchmod,fchmodat,chown,fchown,fchownat,lchown -F key=dac_modification" >> /etc/audit/rules.d/audit.rules
echo "-a always,exit -F arch=b32 -S chmod,fchmod,fchmodat,chown,fchown,fchownat,lchown -F key=dac_modification" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=dac_modification" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.10  Ensure successful file system mounts are collected (Automated) -->
    <Rule id="6.2.3.10">
        <Name>Ensure successful file system mounts are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>Mount and umount operations are not audited.</NonCompliantComment>
        <CorrectiveComment>Add rules for mount/umount2 syscalls.</CorrectiveComment>
        <Correction><![CDATA[
echo "-a always,exit -F arch=b64 -S mount,umount2 -F key=mounts" >> /etc/audit/rules.d/audit.rules
echo "-a always,exit -F arch=b32 -S mount,umount2 -F key=mounts" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=mounts" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.11  Ensure session initiation information is collected (Automated) -->
    <Rule id="6.2.3.11">
        <Name>Ensure session initiation information is collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>Session start records (wtmp/btmp) are not audited.</NonCompliantComment>
        <CorrectiveComment>Add watch rules on /var/log/wtmp.</CorrectiveComment>
        <Correction><![CDATA[
echo "-w /var/log/wtmp -p wa -k session" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "\-w /var/log/wtmp" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.12  Ensure login and logout events are collected (Automated) -->
    <Rule id="6.2.3.12">
        <Name>Ensure login and logout events are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>utmp updates (logins/logouts) are not audited.</NonCompliantComment>
        <CorrectiveComment>Add watch rule on /var/run/utmp.</CorrectiveComment>
        <Correction><![CDATA[
echo "-w /var/run/utmp -p wa -k session" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "\-w /var/run/utmp" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.13  Ensure file deletion events by users are collected (Automated) -->
    <Rule id="6.2.3.13">
        <Name>Ensure file deletion events by users are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>User-initiated file deletions are not audited.</NonCompliantComment>
        <CorrectiveComment>Add rules for unlink/unlinkat/rename syscalls.</CorrectiveComment>
        <Correction><![CDATA[
echo "-a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -F auid>=1000 -F auid!=-1 -k file_deletion" >> /etc/audit/rules.d/audit.rules
echo "-a always,exit -F arch=b32 -S unlink,unlinkat,rename,renameat -F auid>=1000 -F auid!=-1 -k file_deletion" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=file_deletion" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.14  Ensure events that modify the system's Mandatory Access Controls are collected (Automated) -->
    <Rule id="6.2.3.14">
        <Name>Ensure events that modify the system's Mandatory Access Controls are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>SELinux/AppArmor policy files are modified without audit coverage.</NonCompliantComment>
        <CorrectiveComment>Watch /etc/selinux/ and /etc/apparmor/ for changes.</CorrectiveComment>
        <Correction><![CDATA[
echo "-w /etc/selinux/ -p wa -k mac_modification" >> /etc/audit/rules.d/audit.rules
echo "-w /etc/apparmor/ -p wa -k mac_modification" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=mac_modification" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.15  Ensure successful & unsuccessful attempts to use the chcon command are collected (Automated) -->
    <Rule id="6.2.3.15">
        <Name>Ensure successful and unsuccessful attempts to use the chcon command are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>Use of chcon is not audited, risking silent context changes.</NonCompliantComment>
        <CorrectiveComment>Add syscall rules for chcon.</CorrectiveComment>
        <Correction><![CDATA[
echo "-a always,exit -F arch=b64 -S chcon -F key=chcon_usage" >> /etc/audit/rules.d/audit.rules
echo "-a always,exit -F arch=b32 -S chcon -F key=chcon_usage" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=chcon_usage" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.16  Ensure successful & unsuccessful attempts to use the setfacl command are collected (Automated) -->
    <Rule id="6.2.3.16">
        <Name>Ensure successful and unsuccessful attempts to use the setfacl command are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>setfacl modifications are not audited.</NonCompliantComment>
        <CorrectiveComment>Add rules to audit setfacl usage.</CorrectiveComment>
        <Correction><![CDATA[
echo "-a always,exit -F arch=b64 -S setfacl -F key=setfacl_usage" >> /etc/audit/rules.d/audit.rules
echo "-a always,exit -F arch=b32 -S setfacl -F key=setfacl_usage" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=setfacl_usage" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.17  Ensure successful & unsuccessful attempts to use the chacl command are collected (Automated) -->
    <Rule id="6.2.3.17">
        <Name>Ensure successful and unsuccessful attempts to use the chacl command are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>chacl changes are not audited.</NonCompliantComment>
        <CorrectiveComment>Add rules for chacl usage.</CorrectiveComment>
        <Correction><![CDATA[
echo "-a always,exit -F arch=b64 -S chacl -F key=chacl_usage" >> /etc/audit/rules.d/audit.rules
echo "-a always,exit -F arch=b32 -S chacl -F key=chacl_usage" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=chacl_usage" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.18  Ensure successful & unsuccessful attempts to use the usermod command are collected (Automated) -->
    <Rule id="6.2.3.18">
        <Name>Ensure successful and unsuccessful attempts to use the usermod command are collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>usermod executions are not audited, so account changes might be undetected.</NonCompliantComment>
        <CorrectiveComment>Add rules for usermod.</CorrectiveComment>
        <Correction><![CDATA[
echo "-w /usr/sbin/usermod -p x -k usermod_usage" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=usermod_usage" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.19  Ensure kernel module loading unloading and modification is collected (Automated) -->
    <Rule id="6.2.3.19">
        <Name>Ensure kernel module loading unloading and modification is collected (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>Kernel module operations are not audited.</NonCompliantComment>
        <CorrectiveComment>Audit init_module/delete_module syscalls.</CorrectiveComment>
        <Correction><![CDATA[
echo "-a always,exit -F arch=b64 -S init_module,delete_module -k kernel_module" >> /etc/audit/rules.d/audit.rules
echo "-a always,exit -F arch=b32 -S init_module,delete_module -k kernel_module" >> /etc/audit/rules.d/audit.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "key=kernel_module" /etc/audit/rules.d/audit.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.20  Ensure the audit configuration is immutable (Automated) -->
    <Rule id="6.2.3.20">
        <Name>Ensure the audit configuration is immutable (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/rules.d/</BasePath>
        <FileName>immutable.rules</FileName>
        <NonCompliantComment>The audit configuration can still be modified at runtime, allowing attackers to disable auditing.</NonCompliantComment>
        <CorrectiveComment>Add "-e 2" to set the kernel to immutable audit mode.</CorrectiveComment>
        <Correction><![CDATA[
echo "-e 2" >> /etc/audit/rules.d/immutable.rules
augenrules --load
        ]]></Correction>
        <Verification><![CDATA[grep -q "\-e 2" /etc/audit/rules.d/immutable.rules && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.3.21  Ensure the running and on-disk audit configuration is the same (Manual) -->
    <Rule id="6.2.3.21">
        <Name>Ensure the running and on-disk audit configuration is the same (Manual)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.3">Configure auditd Rules</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/</BasePath>
        <FileName>audit.rules</FileName>
        <NonCompliantComment>The in-memory audit rules may differ from those stored on disk.</NonCompliantComment>
        <CorrectiveComment>Compare auditctl -l output with /etc/audit/rules.d/* and reconcile any differences.</CorrectiveComment>
        <Correction><![CDATA[echo "Manual step: run 'diff <(auditctl -l) <(cat /etc/audit/rules.d/*)'"]]></Correction>
        <Verification><![CDATA[echo "Manual verification required"]]></Verification>
        <Manual>YES</Manual>
    </Rule>

    <!-- ───────────── 6.2.4  Configure auditd File Access ───────────── -->

    <Rule id="6.2.4.1">
        <Name>Ensure audit log files mode is configured (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.4">Configure auditd File Access</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/var/log/audit</BasePath>
        <FileName>audit_logs</FileName>
        <NonCompliantComment>Audit log files do not have secure modes.</NonCompliantComment>
        <CorrectiveComment>Set mode 0600 on all audit logs.</CorrectiveComment>
        <Correction><![CDATA[find /var/log/audit -type f -exec chmod 600 {} \;]]></Correction>
        <Verification><![CDATA[for file in $(find /var/log/audit -type f); do stat -c "%a" "$file" | grep -q "^600$" || exit 1; done; echo 0]]></Verification>
        <Manual>NO</Manual>
    </Rule>
    <Rule id="6.2.4.2">
        <Name>Ensure audit log files owner is configured (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.4">Configure auditd File Access</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/var/log/audit</BasePath>
        <FileName>audit_logs</FileName>
        <NonCompliantComment>Audit log files are not owned by root, allowing unauthorized alteration.</NonCompliantComment>
        <CorrectiveComment>Set ownership of all audit log files to root.</CorrectiveComment>
        <Correction><![CDATA[chown -R root:root /var/log/audit]]></Correction>
        <Verification><![CDATA[find /var/log/audit -type f | xargs stat -c "%U" | grep -v '^root$' && echo 1 || echo 0]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.4.3  Ensure audit log files group owner is configured (Automated) -->
    <Rule id="6.2.4.3">
        <Name>Ensure audit log files group owner is configured (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.4">Configure auditd File Access</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/var/log/audit</BasePath>
        <FileName>audit_logs</FileName>
        <NonCompliantComment>Audit logs are not group-owned by root.</NonCompliantComment>
        <CorrectiveComment>Set group ownership of audit logs to root.</CorrectiveComment>
        <Correction><![CDATA[chgrp -R root /var/log/audit]]></Correction>
        <Verification><![CDATA[find /var/log/audit -type f | xargs stat -c "%G" | grep -v '^root$' && echo 1 || echo 0]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.4.4  Ensure the audit log directory mode is configured (Automated) -->
    <Rule id="6.2.4.4">
        <Name>Ensure the audit log directory mode is configured (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.4">Configure auditd File Access</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/var/log/</BasePath>
        <FileName>audit</FileName>
        <NonCompliantComment>The /var/log/audit directory is too permissive.</NonCompliantComment>
        <CorrectiveComment>Set directory permissions to 0700.</CorrectiveComment>
        <Correction><![CDATA[chmod 700 /var/log/audit]]></Correction>
        <Verification><![CDATA[stat -c "%a" /var/log/audit | grep -q "^700$" && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.4.5  Ensure audit configuration files mode is configured (Automated) -->
    <Rule id="6.2.4.5">
        <Name>Ensure audit configuration files mode is configured (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.4">Configure auditd File Access</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/</BasePath>
        <FileName>auditd.conf audit.rules</FileName>
        <NonCompliantComment>Audit configuration files have overly permissive modes.</NonCompliantComment>
        <CorrectiveComment>Set file mode to 0600.</CorrectiveComment>
        <Correction><![CDATA[chmod 600 /etc/audit/auditd.conf /etc/audit/audit.rules]]></Correction>
        <Verification><![CDATA[(stat -c "%a" /etc/audit/auditd.conf | grep -q 600) && (stat -c "%a" /etc/audit/audit.rules | grep -q 600) && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.4.6  Ensure audit configuration files owner is configured (Automated) -->
    <Rule id="6.2.4.6">
        <Name>Ensure audit configuration files owner is configured (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.4">Configure auditd File Access</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/</BasePath>
        <FileName>auditd.conf audit.rules</FileName>
        <NonCompliantComment>Audit config files are not owned by root.</NonCompliantComment>
        <CorrectiveComment>Change owner to root.</CorrectiveComment>
        <Correction><![CDATA[chown root:root /etc/audit/auditd.conf /etc/audit/audit.rules]]></Correction>
        <Verification><![CDATA[(stat -c "%U" /etc/audit/auditd.conf | grep -q root) && (stat -c "%U" /etc/audit/audit.rules | grep -q root) && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.4.7  Ensure audit configuration files group owner is configured (Automated) -->
    <Rule id="6.2.4.7">
        <Name>Ensure audit configuration files group owner is configured (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.4">Configure auditd File Access</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/etc/audit/</BasePath>
        <FileName>auditd.conf audit.rules</FileName>
        <NonCompliantComment>Audit configuration files are not group-owned by root.</NonCompliantComment>
        <CorrectiveComment>Set group ownership to root.</CorrectiveComment>
        <Correction><![CDATA[chgrp root /etc/audit/auditd.conf /etc/audit/audit.rules]]></Correction>
        <Verification><![CDATA[(stat -c "%G" /etc/audit/auditd.conf | grep -q root) && (stat -c "%G" /etc/audit/audit.rules | grep -q root) && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.4.8  Ensure audit tools mode is configured (Automated) -->
    <Rule id="6.2.4.8">
        <Name>Ensure audit tools mode is configured (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.4">Configure auditd File Access</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/usr/sbin/</BasePath>
        <FileName>auditctl ausearch</FileName>
        <NonCompliantComment>Audit utilities have permissive modes.</NonCompliantComment>
        <CorrectiveComment>Set permissions to 0755 or stricter (0600).</CorrectiveComment>
        <Correction><![CDATA[chmod 600 /usr/sbin/auditctl /usr/sbin/ausearch]]></Correction>
        <Verification><![CDATA[(stat -c "%a" /usr/sbin/auditctl | grep -q 600) && (stat -c "%a" /usr/sbin/ausearch | grep -q 600) && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.4.9  Ensure audit tools owner is configured (Automated) -->
    <Rule id="6.2.4.9">
        <Name>Ensure audit tools owner is configured (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.4">Configure auditd File Access</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/usr/sbin/</BasePath>
        <FileName>auditctl ausearch</FileName>
        <NonCompliantComment>Audit tools are not owned by root.</NonCompliantComment>
        <CorrectiveComment>Change ownership to root.</CorrectiveComment>
        <Correction><![CDATA[chown root:root /usr/sbin/auditctl /usr/sbin/ausearch]]></Correction>
        <Verification><![CDATA[(stat -c "%U" /usr/sbin/auditctl | grep -q root) && (stat -c "%U" /usr/sbin/ausearch | grep -q root) && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>

    <!-- 6.2.4.10  Ensure audit tools group owner is configured (Automated) -->
    <Rule id="6.2.4.10">
        <Name>Ensure audit tools group owner is configured (Automated)</Name>
        <Chapter id="6">Logging and Auditing</Chapter>
        <Section id="6.2">System Auditing</Section>
        <SubSection id="6.2.4">Configure auditd File Access</SubSection>
        <Profiles>
            <Profile level="1" type="Server"/>
            <Profile level="1" type="Workstation"/>
        </Profiles>
        <BasePath>/usr/sbin/</BasePath>
        <FileName>auditctl ausearch</FileName>
        <NonCompliantComment>Audit tools are not group-owned by root.</NonCompliantComment>
        <CorrectiveComment>Set group ownership to root.</CorrectiveComment>
        <Correction><![CDATA[chgrp root /usr/sbin/auditctl /usr/sbin/ausearch]]></Correction>
        <Verification><![CDATA[(stat -c "%G" /usr/sbin/auditctl | grep -q root) && (stat -c "%G" /usr/sbin/ausearch | grep -q root) && echo 0 || echo 1]]></Verification>
        <Manual>NO</Manual>
    </Rule>
    <!-- (Les règles 6.2.4.2 à 6.2.4.10 suivent le même modèle, toutes complétées des
         balises Name / Chapter / Section / SubSection et du bloc Profiles.) -->

</RulesCIS>