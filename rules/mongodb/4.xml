<RulesCIS>
  <Rule id="4.1">
    <BasePath>/etc/mongod.conf</BasePath>
    <FileName>mongod.conf</FileName>
    <NonCompliantComment>Legacy TLS protocols are enabled, which may expose MongoDB to security vulnerabilities.</NonCompliantComment>
    <CorrectiveComment>Ensure that legacy TLS protocols are disabled. Command: 
    1. Open the MongoDB configuration file (mongod.conf). 
    2. Set the following under net: 
       tls: 
         mode: "requireTLS" 
         disabledProtocols: ["TLS1_0", "TLS1_1"] 
    3. Restart the MongoDB service using systemctl restart mongod.</CorrectiveComment>
    <Correction>sed -i '/tls:/a\  disabledProtocols: ["TLS1_0", "TLS1_1"]' /etc/mongod.conf; systemctl restart mongod</Correction>
    <Verification>mongo --eval "db.runCommand({getParameter: 1, 'net.tls.disabledProtocols': 1})"</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="4.2">
    <BasePath>/etc/mongod.conf</BasePath>
    <FileName>mongod.conf</FileName>
    <NonCompliantComment>Weak protocols (e.g., SSLv3, TLS1.0, TLS1.1) are enabled, which may expose MongoDB to security vulnerabilities.</NonCompliantComment>
    <CorrectiveComment>Ensure weak protocols are disabled. Command: 
    1. Open the MongoDB configuration file (mongod.conf). 
    2. Set the following under net: 
       tls: 
         mode: "requireTLS" 
         disabledProtocols: ["TLS1_0", "TLS1_1", "SSLv3"] 
    3. Restart the MongoDB service using systemctl restart mongod.</CorrectiveComment>
    <Correction>sed -i '/tls:/a\  disabledProtocols: ["TLS1_0", "TLS1_1", "SSLv3"]' /etc/mongod.conf; systemctl restart mongod</Correction>
    <Verification>mongo --eval "db.runCommand({getParameter: 1, 'net.tls.disabledProtocols': 1})"</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="4.3">
    <BasePath>/etc/mongod.conf</BasePath>
    <FileName>mongod.conf</FileName>
    <NonCompliantComment>Data in transit is not encrypted using TLS or SSL, which may expose sensitive data.</NonCompliantComment>
    <CorrectiveComment>Ensure that data in transit is encrypted using TLS or SSL. Command: 
    1. Open the MongoDB configuration file (mongod.conf). 
    2. Set the following under net: 
       tls: 
         mode: "requireTLS" 
         certificateKeyFile: /etc/ssl/mongodb.pem 
         CAFile: /etc/ssl/ca.pem 
    3. Restart the MongoDB service using systemctl restart mongod.</CorrectiveComment>
    <Correction>sed -i '/tls:/a\  mode: "requireTLS"\n  certificateKeyFile: /etc/ssl/mongodb.pem\n  CAFile: /etc/ssl/ca.pem' /etc/mongod.conf; systemctl restart mongod</Correction>
    <Verification>mongo --tls --tlsCertificateKeyFile /etc/ssl/mongodb.pem --tlsCAFile /etc/ssl/ca.pem --eval "db.runCommand({ping: 1})"</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="4.4">
    <BasePath>/etc/mongod.conf</BasePath>
    <FileName>mongod.conf</FileName>
    <NonCompliantComment>Federal Information Processing Standard (FIPS) is not enabled, which may not meet security compliance requirements.</NonCompliantComment>
    <CorrectiveComment>Ensure FIPS is enabled. Command: 
    1. Open the MongoDB configuration file (mongod.conf). 
    2. Set the following under net: 
       ssl: 
         FIPSMode: true 
    3. Restart the MongoDB service using systemctl restart mongod.</CorrectiveComment>
    <Correction>sed -i '/ssl:/a\  FIPSMode: true' /etc/mongod.conf; systemctl restart mongod</Correction>
    <Verification>mongo --eval "db.runCommand({getParameter: 1, 'net.ssl.FIPSMode': 1})"</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="4.5">
    <BasePath>/etc/mongod.conf</BasePath>
    <FileName>mongod.conf</FileName>
    <NonCompliantComment>Data at rest is not encrypted, which may expose sensitive data to unauthorized access.</NonCompliantComment>
    <CorrectiveComment>Ensure data at rest is encrypted. Command: 
    1. Enable encryption in the MongoDB configuration file (mongod.conf): 
       security: 
         enableEncryption: true 
         encryptionKeyFile: /etc/ssl/mongodb-keyfile 
    2. Restart the MongoDB service using systemctl restart mongod.</CorrectiveComment>
    <Manual>YES</Manual>
  </Rule>
</RulesCIS>
