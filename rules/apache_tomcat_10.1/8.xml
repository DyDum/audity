<RulesCIS>
  <Rule id="8.1">
    <Name>Restrict Runtime Access to Sensitive Packages (Automated)</Name>
    <Chapter id="8">Configure Tomcat Security Manager and Permissions</Chapter>
    <Section id="8.1">Restrict Runtime Access to Sensitive Packages</Section>
    <Profiles>
      <Profile level="2" type="Server"/>
      <Profile level="2" type="Workstation"/>
    </Profiles>
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>catalina.policy</FileName>
    <NonCompliantComment>Runtime access to sensitive packages is not restricted, which may allow unauthorized code execution or manipulation of critical Java classes.</NonCompliantComment>
    <CorrectiveComment>Restrict runtime access to sensitive packages.</CorrectiveComment>
    <Correction>sed -i '/grant codeBase "file:${catalina.home}\/webapps\/-"/a\\tpermission java.lang.RuntimePermission "accessClassInPackage.sun.*", "deny";\\n\\tpermission java.lang.RuntimePermission "accessClassInPackage.com.sun.*", "deny";\\n\\tpermission java.lang.RuntimePermission "accessClassInPackage.org.apache.catalina.*", "deny";' $CATALINA_HOME/conf/catalina.policy; systemctl restart tomcat</Correction>
    <Verification>grep -E 'accessClassInPackage.sun|accessClassInPackage.com|accessClassInPackage.org.apache.catalina' $CATALINA_HOME/conf/catalina.policy &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>
</RulesCIS>
