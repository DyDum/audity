<RulesCIS>
  <Rule id="5.1">
    <Name>Ensure Options is set to None for OS root directory (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.1">Directory Options</Section>
    <SubSection id="5.1.1">OS Root Directory Options</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>httpd.conf</FileName>
    <NonCompliantComment>Options for the OS root directory are not restricted.</NonCompliantComment>
    <CorrectiveComment>Set the Options directive to "None" for the root directory.</CorrectiveComment>
    <Correction>echo "&lt;Directory /&gt;" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "  Options None" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "&lt;/Directory&gt;" &gt;&gt; /etc/httpd/conf/httpd.conf</Correction>
    <Verification>grep -q "&lt;Directory /&gt;" /etc/httpd/conf/httpd.conf &amp;&amp; grep -q "Options None" /etc/httpd/conf/httpd.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.2">
    <Name>Ensure Options is set appropriately for DocumentRoot (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.1">Directory Options</Section>
    <SubSection id="5.1.2">DocumentRoot Options</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/var/www/html</BasePath>
    <FileName>DocumentRoot configuration</FileName>
    <NonCompliantComment>Web root directory options are not restricted.</NonCompliantComment>
    <CorrectiveComment>Set the Options directive to "None" or "Multiviews" as appropriate for the DocumentRoot.</CorrectiveComment>
    <Correction>sed -i 's/Options .*/Options None/' /etc/httpd/conf/httpd.conf</Correction>
    <Verification>grep "Options None" /etc/httpd/conf/httpd.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.3">
    <Name>Ensure Options is minimized for non-critical directories (Manual)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.1">Directory Options</Section>
    <SubSection id="5.1.3">Other Directories Options</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>httpd.conf</FileName>
    <NonCompliantComment>Options for non-critical directories are not minimized.</NonCompliantComment>
    <CorrectiveComment>Review and reduce the Options directives for directories that do not require extended functionality.</CorrectiveComment>
    <Correction>Manual review required; update Options directives to minimal values.</Correction>
    <Verification>Manual verification required</Verification>
    <Manual>YES</Manual>
  </Rule>

  <Rule id="5.4">
    <Name>Ensure default index.html content is removed (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.2">Default Content Removal</Section>
    <SubSection id="5.2.1">Default DocumentRoot Files</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/var/www/html</BasePath>
    <FileName>index.html</FileName>
    <NonCompliantComment>Default HTML content is present.</NonCompliantComment>
    <CorrectiveComment>Remove default index.html content from the DocumentRoot.</CorrectiveComment>
    <Correction>rm -f /var/www/html/index.html</Correction>
    <Verification>[ ! -f /var/www/html/index.html ] &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.5">
    <Name>Ensure default CGI printenv script is removed (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.2">Default Content Removal</Section>
    <SubSection id="5.2.2">CGI Printenv Removal</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/usr/local/apache2/cgi-bin</BasePath>
    <FileName>printenv</FileName>
    <NonCompliantComment>Default CGI printenv script is present.</NonCompliantComment>
    <CorrectiveComment>Remove the default printenv script from the CGI directory.</CorrectiveComment>
    <Correction>rm -f /usr/local/apache2/cgi-bin/printenv</Correction>
    <Verification>[ ! -f /usr/local/apache2/cgi-bin/printenv ] &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.6">
    <Name>Ensure default CGI test-cgi script is removed (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.2">Default Content Removal</Section>
    <SubSection id="5.2.3">CGI Test-cgi Removal</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/usr/local/apache2/cgi-bin</BasePath>
    <FileName>test-cgi</FileName>
    <NonCompliantComment>Default CGI test-cgi script is present.</NonCompliantComment>
    <CorrectiveComment>Remove the default test-cgi script from the CGI directory.</CorrectiveComment>
    <Correction>rm -f /usr/local/apache2/cgi-bin/test-cgi</Correction>
    <Verification>[ ! -f /usr/local/apache2/cgi-bin/test-cgi ] &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.7">
    <Name>Ensure HTTP methods are restricted via LimitExcept (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.3">HTTP Methods Restrictions</Section>
    <SubSection id="5.3.1">Allowed HTTP Methods</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
      <Profile level="2" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>httpd.conf</FileName>
    <NonCompliantComment>HTTP request methods are not restricted.</NonCompliantComment>
    <CorrectiveComment>Add a &lt;LimitExcept&gt; directive to allow only GET, HEAD, POST, and OPTIONS.</CorrectiveComment>
    <Correction>echo "&lt;LimitExcept GET HEAD POST OPTIONS&gt;" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "  Require all denied" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "&lt;/LimitExcept&gt;" &gt;&gt; /etc/httpd/conf/httpd.conf</Correction>
    <Verification>grep -q "&lt;LimitExcept GET HEAD POST OPTIONS&gt;" /etc/httpd/conf/httpd.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.8">
    <Name>Ensure HTTP TRACE method is disabled (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.3">HTTP Methods Restrictions</Section>
    <SubSection id="5.3.2">HTTP TRACE Method</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>httpd.conf</FileName>
    <NonCompliantComment>HTTP TRACE method is enabled.</NonCompliantComment>
    <CorrectiveComment>Disable the HTTP TRACE method by setting TraceEnable to Off.</CorrectiveComment>
    <Correction>echo "TraceEnable Off" &gt;&gt; /etc/httpd/conf/httpd.conf</Correction>
    <Verification>grep -q "^TraceEnable Off" /etc/httpd/conf/httpd.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.9">
    <Name>Ensure only HTTP/1.1 or HTTP/2 protocols are allowed (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.4">Protocol Restrictions</Section>
    <SubSection id="5.4.1">HTTP Protocol Version</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>httpd.conf</FileName>
    <NonCompliantComment>Old HTTP protocol versions are allowed.</NonCompliantComment>
    <CorrectiveComment>Implement rewrite rules to block requests not using HTTP/1.1 or HTTP/2.</CorrectiveComment>
    <Correction>echo "RewriteEngine On" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "RewriteCond %{THE_REQUEST} !HTTP/1\\.1$" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "RewriteRule .* - [F]" &gt;&gt; /etc/httpd/conf/httpd.conf</Correction>
    <Verification>grep -q "RewriteEngine On" /etc/httpd/conf/httpd.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.10">
    <Name>Ensure access to .ht* files is restricted (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.5">Sensitive Files Restrictions</Section>
    <SubSection id="5.5.1">.ht Files Protection</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>httpd.conf</FileName>
    <NonCompliantComment>Access to .ht* files is not restricted.</NonCompliantComment>
    <CorrectiveComment>Add a FilesMatch directive to deny access to files beginning with .ht.</CorrectiveComment>
    <Correction>echo "&lt;FilesMatch \"^\\.ht\"&gt;" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "  Require all denied" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "&lt;/FilesMatch&gt;" &gt;&gt; /etc/httpd/conf/httpd.conf</Correction>
    <Verification>grep -q "&lt;FilesMatch \"^\\.ht\"&gt;" /etc/httpd/conf/httpd.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.11">
    <Name>Ensure access to .git directories is restricted (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.5">Sensitive Files Restrictions</Section>
    <SubSection id="5.5.2">.git Directories Protection</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>httpd.conf</FileName>
    <NonCompliantComment>Access to .git files is not restricted.</NonCompliantComment>
    <CorrectiveComment>Add a DirectoryMatch directive to deny access to .git directories.</CorrectiveComment>
    <Correction>echo "&lt;DirectoryMatch \"/\\.git\"&gt;" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "  Require all denied" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "&lt;/DirectoryMatch&gt;" &gt;&gt; /etc/httpd/conf/httpd.conf</Correction>
    <Verification>grep -q "&lt;DirectoryMatch \"/\\.git\"&gt;" /etc/httpd/conf/httpd.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.12">
    <Name>Ensure access to .svn directories is restricted (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.5">Sensitive Files Restrictions</Section>
    <SubSection id="5.5.3">.svn Directories Protection</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>httpd.conf</FileName>
    <NonCompliantComment>Access to .svn files is not restricted.</NonCompliantComment>
    <CorrectiveComment>Add a DirectoryMatch directive to deny access to .svn directories.</CorrectiveComment>
    <Correction>echo "&lt;DirectoryMatch \"/\\.svn\"&gt;" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "  Require all denied" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "&lt;/DirectoryMatch&gt;" &gt;&gt; /etc/httpd/conf/httpd.conf</Correction>
    <Verification>grep -q "&lt;DirectoryMatch \"/\\.svn\"&gt;" /etc/httpd/conf/httpd.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.13">
    <Name>Ensure only allowed file extensions are accessible (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.6">File Extension Restrictions</Section>
    <SubSection id="5.6.1">Allowed File Extensions</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>allowed_extensions.conf</FileName>
    <NonCompliantComment>Inappropriate file extensions may be accessible.</NonCompliantComment>
    <CorrectiveComment>Create a FilesMatch directive that allows only approved file extensions.</CorrectiveComment>
    <Correction>echo "&lt;FilesMatch \"^.*\\.(css|html?|js|pdf|txt|xml|xsl|gif|ico|jpe?g|png)$\"&gt;" &gt; /etc/httpd/conf/allowed_extensions.conf; echo "  Require all granted" &gt;&gt; /etc/httpd/conf/allowed_extensions.conf; echo "&lt;/FilesMatch&gt;" &gt;&gt; /etc/httpd/conf/allowed_extensions.conf</Correction>
    <Verification>test -f /etc/httpd/conf/allowed_extensions.conf &amp;&amp; grep -q "Require all granted" /etc/httpd/conf/allowed_extensions.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.14">
    <Name>Ensure IP address-based requests are blocked (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.7">Host Header Restrictions</Section>
    <SubSection id="5.7.1">Numeric Host Header Protection</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>httpd.conf</FileName>
    <NonCompliantComment>IP address based requests are allowed.</NonCompliantComment>
    <CorrectiveComment>Add rewrite rules to block requests with a numeric Host header.</CorrectiveComment>
    <Correction>echo "RewriteEngine On" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "RewriteCond %{HTTP_HOST} ^[0-9\\.]+$ [NC]" &gt;&gt; /etc/httpd/conf/httpd.conf; echo "RewriteRule .* - [F]" &gt;&gt; /etc/httpd/conf/httpd.conf</Correction>
    <Verification>grep -q "RewriteCond %{HTTP_HOST} ^[0-9\\.]+$" /etc/httpd/conf/httpd.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.15">
    <Name>Ensure Listen directives specify IP addresses (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.8">Listen Directive Configuration</Section>
    <SubSection id="5.8.1">Listen Address Specification</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>httpd.conf</FileName>
    <NonCompliantComment>Listen directives do not specify an IP address.</NonCompliantComment>
    <CorrectiveComment>Update the Listen directives to include the specific IP address.</CorrectiveComment>
    <Correction>sed -i 's/^Listen [0-9]*/Listen 192.168.1.10:80/' /etc/httpd/conf/httpd.conf</Correction>
    <Verification>grep -q "^Listen 192.168.1.10:80" /etc/httpd/conf/httpd.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.16">
    <Name>Ensure Content-Security-Policy header restricts framing (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.9">HTTP Response Headers</Section>
    <SubSection id="5.9.1">Frame-Ancestors Protection</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>httpd.conf</FileName>
    <NonCompliantComment>No header is configured to restrict browser framing.</NonCompliantComment>
    <CorrectiveComment>Add a Header directive to restrict framing via Content-Security-Policy.</CorrectiveComment>
    <Correction>echo "Header always append Content-Security-Policy \"frame-ancestors 'self'\"" &gt;&gt; /etc/httpd/conf/httpd.conf</Correction>
    <Verification>grep -q "Header always append Content-Security-Policy" /etc/httpd/conf/httpd.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.17">
    <Name>Ensure Referrer-Policy header is set appropriately (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.9">HTTP Response Headers</Section>
    <SubSection id="5.9.2">Referrer-Policy Header</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>httpd.conf</FileName>
    <NonCompliantComment>Referrer-Policy header is not set.</NonCompliantComment>
    <CorrectiveComment>Add a Header directive to set the Referrer-Policy header appropriately.</CorrectiveComment>
    <Correction>echo "Header set Referrer-Policy \"no-referrer-when-downgrade\"" &gt;&gt; /etc/httpd/conf/httpd.conf</Correction>
    <Verification>grep -q "Header set Referrer-Policy" /etc/httpd/conf/httpd.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="5.18">
    <Name>Ensure Permissions-Policy header is set appropriately (Automated)</Name>
    <Chapter id="5">Request and Response Configuration</Chapter>
    <Section id="5.9">HTTP Response Headers</Section>
    <SubSection id="5.9.3">Permissions-Policy Header</SubSection>

    <Profiles>
      <Profile level="1" type="Server"/>
    </Profiles>
    <BasePath>/etc/httpd/conf</BasePath>
    <FileName>httpd.conf</FileName>
    <NonCompliantComment>Permissions-Policy header is not set.</NonCompliantComment>
    <CorrectiveComment>Add a Header directive to set the Permissions-Policy header with an appropriate allowlist.</CorrectiveComment>
    <Correction>echo "Header set Permissions-Policy \"geolocation=(), microphone=()\"" &gt;&gt; /etc/httpd/conf/httpd.conf</Correction>
    <Verification>grep -q "Header set Permissions-Policy" /etc/httpd/conf/httpd.conf &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>
</RulesCIS>
