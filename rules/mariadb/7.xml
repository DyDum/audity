<ReglesCIS>
    <Regle id="7.1">
    <CheminBase>/etc/mysql/</CheminBase>
    <NomFichier>my.cnf</NomFichier>
    <RegleNonConforme>The 'mysql_old_password' plugin is enabled, which may allow the use of weak password hashing algorithms.</RegleNonConforme>
    <RegleCorrigee>Disable the 'mysql_old_password' plugin to enforce strong password hashing algorithms.</RegleCorrigee>
    <Correction>mysql -u root -p -e "UNINSTALL PLUGIN mysql_old_password;"</Correction>
    <Verification>mysql -u root -p -e "SHOW PLUGINS;" | grep -q 'mysql_old_password' && echo 1 || echo 0</Verification>
  </Regle>

  <Regle id="7.2">
    <CheminBase>/etc/mysql/</CheminBase>
    <NomFichier>my.cnf</NomFichier>
    <RegleNonConforme>Passwords are stored in the global configuration, which may expose them to unauthorized users.</RegleNonConforme>
    <RegleCorrigee>Ensure passwords are not stored in the global configuration file.</RegleCorrigee>
    <Correction>sed -i '/password=/d' /etc/mysql/my.cnf</Correction>
    <Verification>grep -q 'password=' /etc/mysql/my.cnf && echo 1 || echo 0</Verification>
  </Regle>

  <Regle id="7.3">
    <CheminBase>/etc/mysql/</CheminBase>
    <NomFichier>my.cnf</NomFichier>
    <RegleNonConforme>Weak authentication mechanisms are used for user accounts, increasing security risks.</RegleNonConforme>
    <RegleCorrigee>Ensure strong authentication mechanisms are used (e.g., caching_sha2_password).</RegleCorrigee>
    <Correction>sed -i '/\[mysqld\]/a default_authentication_plugin=caching_sha2_password' /etc/mysql/my.cnf</Correction>
    <Verification>mysql -u root -p -e "SHOW VARIABLES LIKE 'default_authentication_plugin';" | grep -q 'caching_sha2_password' && echo 0 || echo 1</Verification>
  </Regle>

  <Regle id="7.4">
    <CheminBase>/etc/mysql/</CheminBase>
    <NomFichier>my.cnf</NomFichier>
    <RegleNonConforme>No password complexity policies are enforced, which may allow weak passwords.</RegleNonConforme>
    <RegleCorrigee>Configure password complexity policies, including minimum length and character requirements.</RegleCorrigee>
    <Correction>sed -i '/\[mysqld\]/a validate_password_policy=MEDIUM; validate_password_length=12' /etc/mysql/my.cnf</Correction>
    <Verification>mysql -u root -p -e "SHOW VARIABLES LIKE 'validate_password%';"</Verification>
  </Regle>

  <Regle id="7.5">
    <CheminBase>/etc/mysql/</CheminBase>
    <NomFichier>mysql.user</NomFichier>
    <RegleNonConforme>Users have wildcard hostnames, which may allow unauthorized access.</RegleNonConforme>
    <RegleCorrigee>Ensure user accounts are restricted to specific hostnames or IP addresses.</RegleCorrigee>
    <Correction>mysql -u root -p -e "DELETE FROM mysql.user WHERE host='%' AND user NOT IN ('root'); FLUSH PRIVILEGES;"</Correction>
    <Verification>mysql -u root -p -e "SELECT user,host FROM mysql.user WHERE host='%';" | grep -v 'root' && echo 1 || echo 0</Verification>
  </Regle>

  <Regle id="7.6">
    <CheminBase>/etc/mysql/</CheminBase>
    <NomFichier>mysql.user</NomFichier>
    <RegleNonConforme>Anonymous accounts exist, which may allow unauthorized access.</RegleNonConforme>
    <RegleCorrigee>Ensure no anonymous accounts exist in the database.</RegleCorrigee>
    <Correction>mysql -u root -p -e "DELETE FROM mysql.user WHERE user=''; FLUSH PRIVILEGES;"</Correction>
    <Verification>mysql -u root -p -e "SELECT user,host FROM mysql.user WHERE user='';" | grep -q '.' && echo 1 || echo 0</Verification>
  </Regle>

  <Regle id="7.7">
    <CheminBase>/etc/mysql/</CheminBase>
    <NomFichier>my.cnf</NomFichier>
    <RegleNonConforme>Passwords can be reused without restriction, which may weaken account security.</RegleNonConforme>
    <RegleCorrigee>Enforce password reuse policies by configuring a password history setting.</RegleCorrigee>
    <Correction>sed -i '/\[mysqld\]/a password_reuse_history=5' /etc/mysql/my.cnf</Correction>
    <Verification>mysql -u root -p -e "SHOW VARIABLES LIKE 'password_reuse_history';" | grep -q '5' && echo 0 || echo 1</Verification>
  </Regle>
</ReglesCIS>
