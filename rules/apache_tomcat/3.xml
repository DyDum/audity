<ReglesCIS>
  <Rule id="3.1">
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>server.xml</FileName>
    <NonCompliantComment>The shutdown command is set to the default value ('SHUTDOWN'), which may allow unauthorized shutdown of the Tomcat server.</NonCompliantComment>
    <CorrectiveComment>Set a nondeterministic shutdown command value. Command: 
    1. Open the server.xml file in a text editor. 
    2. Locate the <Server> element and modify the shutdown attribute to a custom value. 
       Example: <Server port="8005" shutdown="SecureShutdown"/> 
    3. Save the file and restart the Tomcat service using systemctl restart tomcat.</CorrectiveComment>
    <Correction>sed -i '/<Server /s/shutdown=".*"/shutdown="SecureShutdown"/' $CATALINA_HOME/conf/server.xml; systemctl restart tomcat</Correction>
    <Verification>grep 'shutdown="SecureShutdown"' $CATALINA_HOME/conf/server.xml && echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="3.2">
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>server.xml</FileName>
    <NonCompliantComment>The shutdown port is enabled, which may allow unauthorized users to remotely shut down the server.</NonCompliantComment>
    <CorrectiveComment>Disable the shutdown port by setting it to '-1'. Command: 
    1. Open the server.xml file in a text editor. 
    2. Locate the <Server> element and set the port attribute to '-1'. 
       Example: <Server port="-1" shutdown="SecureShutdown"/> 
    3. Save the file and restart the Tomcat service using systemctl restart tomcat.</CorrectiveComment>
    <Correction>sed -i '/<Server /s/port=".*"/port="-1"/' $CATALINA_HOME/conf/server.xml; systemctl restart tomcat</Correction>
    <Verification>grep '<Server port="-1"' $CATALINA_HOME/conf/server.xml && echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>
</ReglesCIS>
