<ReglesCIS>
  <Rule id="6.1">
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>server.xml</FileName>
    <NonCompliantComment>Client-cert authentication is not enabled for sensitive connectors, which may expose the server to unauthorized access.</NonCompliantComment>
    <CorrectiveComment>Setup client-cert authentication for secure connectors. Command: 
    1. Open the server.xml file. 
    2. Locate the <Connector> element for the HTTPS port. 
    3. Add the following attributes: 
       clientAuth="true" 
       sslProtocol="TLS" 
       keystoreFile="/path/to/keystore.jks" 
       keystorePass="YourPassword" 
    4. Save the file and restart Tomcat using systemctl restart tomcat.</CorrectiveComment>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="6.2">
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>server.xml</FileName>
    <NonCompliantComment>The SSLEnabled attribute is not set to 'true' for sensitive connectors, which may allow unencrypted communications.</NonCompliantComment>
    <CorrectiveComment>Ensure SSLEnabled is set to 'true' for sensitive connectors. Command: 
    1. Open the server.xml file. 
    2. Locate the <Connector> element for the HTTPS port. 
    3. Set SSLEnabled="true". 
    4. Save the file and restart Tomcat using systemctl restart tomcat.</CorrectiveComment>
    <Correction>sed -i '/<Connector/s/SSLEnabled="false"/SSLEnabled="true"/' $CATALINA_HOME/conf/server.xml; systemctl restart tomcat</Correction>
    <Verification>grep 'SSLEnabled="true"' $CATALINA_HOME/conf/server.xml && echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="6.3">
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>server.xml</FileName>
    <NonCompliantComment>The scheme attribute for connectors is not set accurately, which may lead to insecure configurations.</NonCompliantComment>
    <CorrectiveComment>Ensure the scheme is set accurately (e.g., "https" for secure connectors). Command: 
    1. Open the server.xml file. 
    2. Locate the <Connector> element for HTTPS. 
    3. Set scheme="https". 
    4. Save the file and restart Tomcat using systemctl restart tomcat.</CorrectiveComment>
    <Correction>sed -i '/<Connector/s/scheme=".*"/scheme="https"/' $CATALINA_HOME/conf/server.xml; systemctl restart tomcat</Correction>
    <Verification>grep 'scheme="https"' $CATALINA_HOME/conf/server.xml && echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="6.4">
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>server.xml</FileName>
    <NonCompliantComment>The secure attribute is not set correctly, which may expose the server to insecure communications.</NonCompliantComment>
    <CorrectiveComment>Ensure the secure attribute is set to true only for SSL-enabled connectors. Command: 
    1. Open the server.xml file. 
    2. Locate the <Connector> element for HTTPS. 
    3. Set secure="true". 
    4. Save the file and restart Tomcat using systemctl restart tomcat.</CorrectiveComment>
    <Correction>sed -i '/<Connector/s/secure=".*"/secure="true"/' $CATALINA_HOME/conf/server.xml; systemctl restart tomcat</Correction>
    <Verification>grep 'secure="true"' $CATALINA_HOME/conf/server.xml && echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="6.5">
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>server.xml</FileName>
    <NonCompliantComment>The 'sslProtocol' attribute is not configured correctly for secure connectors, which may allow weak SSL/TLS protocols.</NonCompliantComment>
    <CorrectiveComment>Ensure 'sslProtocol' is configured correctly for secure connectors. Command: 
    1. Open the server.xml file. 
    2. Locate the <Connector> element for HTTPS. 
    3. Set sslProtocol="TLSv1.2" or higher. 
    4. Save the file and restart Tomcat using systemctl restart tomcat.</CorrectiveComment>
    <Correction>sed -i '/<Connector/s/sslProtocol=".*"/sslProtocol="TLSv1.2"/' $CATALINA_HOME/conf/server.xml; systemctl restart tomcat</Correction>
    <Verification>grep 'sslProtocol="TLSv1.2"' $CATALINA_HOME/conf/server.xml && echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>
</ReglesCIS>
