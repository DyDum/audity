<RulesCIS>
  <Rule id="7.1">
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>logging.properties</FileName>
    <NonCompliantComment>Application-specific logging is not enabled, which may reduce visibility into application events.</NonCompliantComment>
    <CorrectiveComment>Ensure application-specific logging is enabled. Command: 
    1. Open the logging.properties file in a text editor. 
    2. Add or modify the following entries: 
       org.apache.catalina.level = FINE 
       org.apache.catalina.handlers = java.util.logging.ConsoleHandler 
    3. Save the file and restart Tomcat using systemctl restart tomcat.</CorrectiveComment>
    <Correction>sed -i '/org.apache.catalina.level/c\org.apache.catalina.level = FINE' $CATALINA_HOME/conf/logging.properties; systemctl restart tomcat</Correction>
    <Verification>grep 'org.apache.catalina.level = FINE' $CATALINA_HOME/conf/logging.properties &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="7.2">
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>logging.properties</FileName>
    <NonCompliantComment>No file handler is specified for logging, which may result in logs not being saved to disk.</NonCompliantComment>
    <CorrectiveComment>Specify a file handler for logging. Command: 
    1. Open the logging.properties file in a text editor. 
    2. Add the following line: 
       java.util.logging.FileHandler.pattern = $CATALINA_HOME/logs/tomcat.log 
    3. Save the file and restart Tomcat using systemctl restart tomcat.</CorrectiveComment>
    <Correction>echo "java.util.logging.FileHandler.pattern = $CATALINA_HOME/logs/tomcat.log" &gt;&gt; $CATALINA_HOME/conf/logging.properties; systemctl restart tomcat</Correction>
    <Verification>grep 'java.util.logging.FileHandler.pattern' $CATALINA_HOME/conf/logging.properties &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="7.3">
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>context.xml</FileName>
    <NonCompliantComment>The className attribute for logging is not set correctly in context.xml, which may prevent correct logging.</NonCompliantComment>
    <CorrectiveComment>Ensure the className is set correctly for logging in context.xml. Command: 
    1. Open the context.xml file in a text editor. 
    2. Ensure the following entry is present: 
       <Logger className="org.apache.catalina.logger.FileLogger" prefix="localhost_log" suffix=".txt" timestamp="true" /> 
    3. Save the file and restart Tomcat using systemctl restart tomcat.</CorrectiveComment>
    <Correction>sed -i '/<Logger /s/className=".*"/className="org.apache.catalina.logger.FileLogger"/' $CATALINA_HOME/conf/context.xml; systemctl restart tomcat</Correction>
    <Verification>grep 'className="org.apache.catalina.logger.FileLogger"' $CATALINA_HOME/conf/context.xml &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="7.4">
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>context.xml</FileName>
    <NonCompliantComment>The logging directory specified in context.xml is not a secure location, which may allow unauthorized access.</NonCompliantComment>
    <CorrectiveComment>Ensure the logging directory in context.xml is set to a secure location (e.g., /var/log/tomcat). Command: 
    1. Open the context.xml file in a text editor. 
    2. Set the directory attribute of the <Logger> element to a secure path: 
       <Logger className="org.apache.catalina.logger.FileLogger" directory="/var/log/tomcat" prefix="localhost_log" suffix=".txt" timestamp="true" /> 
    3. Save the file and restart Tomcat using systemctl restart tomcat.</CorrectiveComment>
    <Manual>YES</Manual>
  </Rule>

  <Rule id="7.5">
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>context.xml</FileName>
    <NonCompliantComment>The logging pattern in context.xml is not set correctly, which may result in incomplete log information.</NonCompliantComment>
    <CorrectiveComment>Ensure the logging pattern in context.xml is correct. Command: 
    1. Open the context.xml file in a text editor. 
    2. Ensure the logging pattern follows the format: 
       <Logger className="org.apache.catalina.logger.FileLogger" prefix="localhost_log" suffix=".txt" pattern="%h %l %u %t &quot;%r&quot; %s %b" /> 
    3. Save the file and restart Tomcat using systemctl restart tomcat.</CorrectiveComment>
    <Correction>sed -i '/<Logger /s/pattern=".*"/pattern="%h %l %u %t &quot;%r&quot; %s %b"/' $CATALINA_HOME/conf/context.xml; systemctl restart tomcat</Correction>
    <Verification>grep 'pattern="%h %l %u %t &quot;%r&quot; %s %b"' $CATALINA_HOME/conf/context.xml &amp;&amp; echo 0 || echo 1</Verification>
    <Manual>NO</Manual>
  </Rule>

  <Rule id="7.6">
    <BasePath>$CATALINA_HOME/conf/</BasePath>
    <FileName>logging.properties</FileName>
    <NonCompliantComment>The directory specified in logging.properties for log files is not a secure location.</NonCompliantComment>
    <CorrectiveComment>Ensure the directory specified in logging.properties is a secure location. Command: 
    1. Open the logging.properties file in a text editor. 
    2. Set the file handler directory to a secure path: 
       java.util.logging.FileHandler.pattern = /var/log/tomcat/tomcat.log 
    3. Save the file and restart Tomcat using systemctl restart tomcat.</CorrectiveComment>
    <Manual>YES</Manual>
  </Rule>
</RulesCIS>
