<RulesCIS>
    <Rule id="1.3.1.1">
        <BasePath>/etc/apparmor.d/</BasePath>
        <FileName>apparmor</FileName>
        <NonCompliantComment>AppArmor is not installed, leaving the system without mandatory access control for applications.</NonCompliantComment>
        <CorrectiveComment>Install the AppArmor packages and utilities to enable mandatory access control.</CorrectiveComment>
        <Correction>apt-get install apparmor apparmor-utils</Correction>
        <Verification>dpkg -l | grep -q apparmor && echo 0 || echo 1</Verification>
    </Rule>
    <Rule id="1.3.1.2">
        <BasePath>/etc/default/grub</BasePath>
        <FileName>grub</FileName>
        <NonCompliantComment>AppArmor is not enabled in the bootloader configuration, which may prevent it from starting at boot.</NonCompliantComment>
        <CorrectiveComment>Edit /etc/default/grub to include "apparmor=1 security=apparmor" in GRUB_CMDLINE_LINUX and update the bootloader.</CorrectiveComment>
        <Correction>sed -i 's/GRUB_CMDLINE_LINUX="/GRUB_CMDLINE_LINUX="apparmor=1 security=apparmor /' /etc/default/grub; update-grub</Correction>
        <Verification>grep -q 'apparmor=1' /proc/cmdline && echo 0 || echo 1</Verification>
    </Rule>
    <Rule id="1.3.1.3">
        <BasePath>/etc/apparmor.d/</BasePath>
        <FileName>*</FileName>
        <NonCompliantComment>Some AppArmor profiles are not set to enforce or complain mode, reducing the effectiveness of mandatory access control.</NonCompliantComment>
        <CorrectiveComment>Set all AppArmor profiles to either enforce or complain mode according to your security policy.</CorrectiveComment>
        <Correction>aa-enforce /etc/apparmor.d/*</Correction>
        <Verification>(aa-status | grep -q 'enforce mode') && echo 0 || echo 1</Verification>
    </Rule>
    <Rule id="1.3.1.4">
        <BasePath>/etc/apparmor.d/</BasePath>
        <FileName>*</FileName>
        <NonCompliantComment>Not all AppArmor profiles are set to enforce mode, potentially leaving the system vulnerable.</NonCompliantComment>
        <CorrectiveComment>Ensure all AppArmor profiles are set to enforce mode.</CorrectiveComment>
        <Correction>aa-enforce /etc/apparmor.d/*</Correction>
        <Verification>(aa-status | grep -q 'enforce mode') && echo 0 || echo 1</Verification>
    </Rule>
</RulesCIS>
