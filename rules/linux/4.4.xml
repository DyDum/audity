<RulesCIS>
    <Rule id="4.4.1.1">
        <BasePath>/usr/sbin/</BasePath>
        <FileName>iptables</FileName>
        <NonCompliantComment> The iptables package is not installed, leaving the system without proper IPv4 firewall management. </NonCompliantComment>
        <CorrectiveComment> Install the iptables package to manage IPv4 firewall rules. </CorrectiveComment>
        <Correction>apt-get install -y iptables</Correction>
        <Verification>dpkg -l | grep -q iptables && echo 0 || echo 1</Verification>
    </Rule>
    <Rule id="4.4.1.2">
        <BasePath>/</BasePath>
        <FileName>nftables</FileName>
        <NonCompliantComment> Nftables is installed and active, which may conflict with iptables. </NonCompliantComment>
        <CorrectiveComment> Uninstall nftables to ensure iptables is solely in use. </CorrectiveComment>
        <Correction>apt-get purge -y nftables</Correction>
        <Verification>dpkg -l | grep -q nftables && echo 1 || echo 0</Verification>
    </Rule>
    <Rule id="4.4.1.3">
        <BasePath>/</BasePath>
        <FileName>ufw</FileName>
        <NonCompliantComment> UFW is installed and may conflict with iptables management. </NonCompliantComment>
        <CorrectiveComment> Uninstall UFW when using iptables exclusively. </CorrectiveComment>
        <Correction>apt-get purge -y ufw</Correction>
        <Verification>dpkg -l | grep -q ufw && echo 1 || echo 0</Verification>
    </Rule>
    <Rule id="4.4.2.1">
        <BasePath>/</BasePath>
        <FileName>iptables_rules.sh</FileName>
        <NonCompliantComment> The default policy for iptables is not set to deny, which may allow unauthorized access. </NonCompliantComment>
        <CorrectiveComment> Set the default iptables policy for INPUT and FORWARD chains to DROP, and for OUTPUT to ACCEPT. </CorrectiveComment>
        <Correction>iptables -P INPUT DROP; iptables -P FORWARD DROP; iptables -P OUTPUT ACCEPT</Correction>
        <Verification>iptables -L INPUT | grep "policy DROP" &amp;&amp; iptables -L FORWARD | grep "policy DROP" &amp;&amp; iptables -L OUTPUT | grep "policy ACCEPT" &amp;&amp; echo 0 || echo 1</Verification>
    </Rule>
    <Rule id="4.4.2.2">
        <BasePath>/</BasePath>
        <FileName>iptables_rules.sh</FileName>
        <NonCompliantComment> Loopback traffic is not explicitly allowed in iptables. </NonCompliantComment>
        <CorrectiveComment> Add a rule to allow all traffic on the loopback interface. </CorrectiveComment>
        <Correction>iptables -A INPUT -i lo -j ACCEPT</Correction>
        <Verification>iptables -L INPUT | grep -q "lo" &amp;&amp; echo 0 || echo 1</Verification>
    </Rule>
    <Rule id="4.4.2.3">
        <BasePath>/</BasePath>
        <FileName>iptables_rules.sh</FileName>
        <NonCompliantComment> Rules for outbound and established connections are not configured, potentially disrupting legitimate traffic. </NonCompliantComment>
        <CorrectiveComment> Manually configure rules to allow established and outbound connections. </CorrectiveComment>
        <Correction>echo "Manual configuration required: add rules for established and outbound connections"</Correction>
        <Verification>echo "Manual verification required"</Verification>
    </Rule>
    <Rule id="4.4.2.4">
        <BasePath>/</BasePath>
        <FileName>iptables_rules.sh</FileName>
        <NonCompliantComment> There are open ports without corresponding iptables rules, potentially exposing the system. </NonCompliantComment>
        <CorrectiveComment> Define iptables rules for all open ports to restrict unauthorized access. </CorrectiveComment>
        <Correction>echo "Manual configuration required: review open ports and add corresponding iptables rules"</Correction>
        <Verification>echo "Manual verification required"</Verification>
    </Rule>
    <Rule id="4.4.3.1">
        <BasePath>/</BasePath>
        <FileName>ip6tables_rules.sh</FileName>
        <NonCompliantComment> The default policy for ip6tables is not set to deny, which may allow unauthorized IPv6 traffic. </NonCompliantComment>
        <CorrectiveComment> Set the default ip6tables policy for INPUT and FORWARD chains to DROP, and for OUTPUT to ACCEPT. </CorrectiveComment>
        <Correction>ip6tables -P INPUT DROP; ip6tables -P FORWARD DROP; ip6tables -P OUTPUT ACCEPT</Correction>
        <Verification>ip6tables -L INPUT | grep "policy DROP" &amp;&amp; ip6tables -L FORWARD | grep "policy DROP" &amp;&amp; ip6tables -L OUTPUT | grep "policy ACCEPT" &amp;&amp; echo 0 || echo 1</Verification>
    </Rule>
    <Rule id="4.4.3.2">
        <BasePath>/</BasePath>
        <FileName>ip6tables_rules.sh</FileName>
        <NonCompliantComment> Loopback traffic is not properly configured in ip6tables. </NonCompliantComment>
        <CorrectiveComment> Add a rule to allow all traffic on the IPv6 loopback interface. </CorrectiveComment>
        <Correction>ip6tables -A INPUT -i lo -j ACCEPT</Correction>
        <Verification>ip6tables -L INPUT | grep -q "lo" &amp;&amp; echo 0 || echo 1</Verification>
    </Rule>
    <Rule id="4.4.3.3">
        <BasePath>/</BasePath>
        <FileName>ip6tables_rules.sh</FileName>
        <NonCompliantComment> Rules for outbound and established connections for IPv6 are not configured, which may disrupt legitimate traffic. </NonCompliantComment>
        <CorrectiveComment> Manually configure rules to allow established and outbound IPv6 connections. </CorrectiveComment>
        <Correction>echo "Manual configuration required: add rules for established and outbound IPv6 connections"</Correction>
        <Verification>echo "Manual verification required"</Verification>
    </Rule>
    <Rule id="4.4.3.4">
    <BasePath>/</BasePath>
        <FileName>ip6tables_rules.sh</FileName>
        <NonCompliantComment> There are open IPv6 ports without corresponding ip6tables rules, potentially exposing the system. </NonCompliantComment>
        <CorrectiveComment> Define ip6tables rules for all open ports to secure IPv6 traffic. </CorrectiveComment>
        <Correction>echo "Manual configuration required: review open IPv6 ports and add corresponding rules"</Correction>
        <Verification>echo "Manual verification required"</Verification>
    </Rule>
</RulesCIS>